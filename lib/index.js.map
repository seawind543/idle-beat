{"version":3,"file":"index.js","mappings":"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","sources":["webpack://IdleBeat/webpack/universalModuleDefinition","webpack://IdleBeat/./src/idleBeat.ts","webpack://IdleBeat/./src/index.ts","webpack://IdleBeat/./src/constants.ts","webpack://IdleBeat/./src/utils/isHumanScroll.ts","webpack://IdleBeat/./src/utils/requestInterval.ts","webpack://IdleBeat/webpack/bootstrap","webpack://IdleBeat/webpack/startup"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"idle-beat\"] = factory();\n\telse\n\t\troot[\"IdleBeat\"] = factory();\n})(this, () => {\nreturn ","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst requestInterval_1 = __importDefault(require(\"./utils/requestInterval\"));\nconst isHumanScroll_1 = __importDefault(require(\"./utils/isHumanScroll\"));\nconst constants_1 = require(\"./constants\");\nfunction dispatchEvent(type, getConfig, getState) {\n    const config = getConfig();\n    const { target, activeEventName, idleEventName } = config;\n    const customEventType = type === 'active' ? activeEventName : idleEventName;\n    const idleEvent = new CustomEvent(customEventType, {\n        detail: {\n            state: getState(),\n            config,\n        },\n        bubbles: true,\n    });\n    target.dispatchEvent(idleEvent);\n}\nfunction idleHandlerFactory(getConfig, getState, setState) {\n    return () => {\n        const newState = Object.assign(Object.assign({}, getState()), { isIdle: true });\n        setState(newState);\n        dispatchEvent('idle', getConfig, getState);\n    };\n}\nfunction activeHandlerFactory(getConfig, getState, setState, beatIdle) {\n    return (event) => {\n        var _a;\n        const lastEventType = (_a = event === null || event === void 0 ? void 0 : event.type) !== null && _a !== void 0 ? _a : null;\n        if (lastEventType === 'scroll' && !(0, isHumanScroll_1.default)(event)) {\n            return;\n        }\n        const newState = Object.assign(Object.assign({}, getState()), { isIdle: false, lastActive: Date.now(), lastEventType });\n        setState(newState);\n        dispatchEvent('active', getConfig, getState);\n        beatIdle();\n    };\n}\nfunction getMonitorTarget(eventType, target) {\n    const WINDOWS_EVENTS = [\n        'resize',\n        'orientationchange',\n    ];\n    const monitorTarget = WINDOWS_EVENTS.includes(eventType)\n        ? window\n        : target;\n    return monitorTarget;\n}\nfunction idleBeat(options) {\n    let state = structuredClone(constants_1.DEFAULT_STATE);\n    const getState = () => structuredClone(state);\n    const setState = (newState) => {\n        state = structuredClone(newState);\n    };\n    const config = Object.assign(Object.assign({}, constants_1.DEFAULT_CONFIG), options);\n    const getConfig = () => config;\n    const setConfig = (newConfig) => {\n        if (getState().isBeating) {\n            return;\n        }\n        Object.assign(getConfig(), newConfig);\n    };\n    let activeHandler = null;\n    let cancelInterval;\n    const beatIdle = () => {\n        const { beat } = getConfig();\n        cancelInterval === null || cancelInterval === void 0 ? void 0 : cancelInterval();\n        cancelInterval = (0, requestInterval_1.default)(idleHandlerFactory(getConfig, getState, setState), beat * 1e3);\n    };\n    const stop = () => {\n        const { target, events: activeEvents } = getConfig();\n        setState(Object.assign(Object.assign({}, getState()), { isBeating: false, isIdle: false }));\n        cancelInterval === null || cancelInterval === void 0 ? void 0 : cancelInterval();\n        if (activeHandler) {\n            activeEvents.forEach((eventType) => {\n                const monitorTarget = getMonitorTarget(eventType, target);\n                monitorTarget.removeEventListener(eventType, activeHandler, true);\n            });\n        }\n    };\n    const start = () => {\n        if (getState().isBeating) {\n            return;\n        }\n        const { target, events: activeEvents } = getConfig();\n        setState(Object.assign(Object.assign({}, getState()), { lastActive: Date.now(), lastEventType: null, isIdle: false, isBeating: true }));\n        activeHandler = activeHandlerFactory(getConfig, getState, setState, beatIdle);\n        activeEvents.forEach((eventType) => {\n            const monitorTarget = getMonitorTarget(eventType, target);\n            monitorTarget.addEventListener(eventType, activeHandler, true);\n        });\n        beatIdle();\n    };\n    return {\n        getState,\n        getConfig,\n        setConfig,\n        start,\n        stop,\n    };\n}\nexports.default = idleBeat;\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.DEFAULT_CONFIG = void 0;\nconst idleBeat_1 = __importDefault(require(\"./idleBeat\"));\nvar constants_1 = require(\"./constants\");\nObject.defineProperty(exports, \"DEFAULT_CONFIG\", { enumerable: true, get: function () { return constants_1.DEFAULT_CONFIG; } });\nexports.default = idleBeat_1.default;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.DEFAULT_CONFIG = exports.DEFAULT_STATE = void 0;\nexports.DEFAULT_STATE = {\n    lastActive: 0,\n    lastEventType: null,\n    isIdle: false,\n    isBeating: false,\n};\nexports.DEFAULT_CONFIG = {\n    id: 'default',\n    idleEventName: 'idle',\n    activeEventName: 'active',\n    beat: 10,\n    target: document,\n    events: [\n        'mousedown',\n        'mousemove',\n        'mouseup',\n        'click',\n        'scroll',\n        'touchstart',\n        'touchmove',\n        'touchend',\n        'keydown',\n        'keypress',\n        'change',\n        'visibilitychange',\n        'resize',\n        'orientationchange',\n    ],\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst SCROLL_ATTENDANCE_TIMEOUT = 200;\nlet lastHumanScroll = 0;\n['wheel', 'touchstart', 'keydown'].forEach((e) => {\n    window.addEventListener(e, () => {\n        lastHumanScroll = Date.now();\n    }, true);\n});\nconst isHumanScroll = (event) => {\n    return ((event === null || event === void 0 ? void 0 : event.type) === 'scroll' &&\n        Date.now() - lastHumanScroll < SCROLL_ATTENDANCE_TIMEOUT);\n};\nexports.default = isHumanScroll;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction requestInterval(callback, delay) {\n    let start = Date.now();\n    let handle = null;\n    const interval = () => {\n        const current = Date.now();\n        const elapsed = current - start;\n        if (elapsed >= delay) {\n            callback(current);\n            start = Date.now();\n        }\n        handle = requestAnimationFrame(interval);\n    };\n    handle = requestAnimationFrame(interval);\n    return () => {\n        if (handle) {\n            cancelAnimationFrame(handle);\n        }\n    };\n}\nexports.default = requestInterval;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(129);\n"],"names":["root","factory","exports","module","define","amd","this","__importDefault","mod","__esModule","Object","defineProperty","value","requestInterval_1","require","isHumanScroll_1","constants_1","dispatchEvent","type","getConfig","getState","config","target","activeEventName","idleEventName","idleEvent","CustomEvent","detail","state","bubbles","getMonitorTarget","eventType","includes","window","options","cancelInterval","structuredClone","DEFAULT_STATE","setState","newState","assign","DEFAULT_CONFIG","activeHandler","beatIdle","beat","isIdle","idleHandlerFactory","setConfig","newConfig","isBeating","start","_getConfig3","activeEvents","events","lastActive","Date","now","lastEventType","event","_a","activeHandlerFactory","forEach","addEventListener","stop","_getConfig2","removeEventListener","idleBeat_1","enumerable","get","id","document","lastHumanScroll","e","callback","delay","handle","interval","current","requestAnimationFrame","cancelAnimationFrame","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","call"],"sourceRoot":""}